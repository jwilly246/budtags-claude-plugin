# Migration Guide: React 19.0 to React 19.1

Changes and migration steps from React 19.0 to React 19.1 (March 2025).

## Overview

React 19.1 is a minor release with bug fixes and developer experience improvements. Most apps should upgrade without issues.

---

## Package Update

```bash
npm install react@19.1 react-dom@19.1
npm install -D @types/react@19 @types/react-dom@19
```

---

## Changes

### 1. useId Format Change

**Before (19.0):** `:r123:`
**After (19.1):** `«r123»`

```typescript
const id = useId();
// 19.0: ":r0:"
// 19.1: "«r0»"
```

**Impact:** Low - unless you're parsing useId output (which you shouldn't be).

**If affected:**
```typescript
// ❌ Don't do this
const match = id.match(/:r(\d+):/);

// ✅ Use the id directly
<input id={id} />
<label htmlFor={id}>Label</label>
```

---

### 2. Owner Stack (Development Only)

New API for debugging component relationships:

```typescript
import { captureOwnerStack } from 'react';

// In development only
function DebugComponent() {
  if (process.env.NODE_ENV === 'development') {
    const ownerStack = captureOwnerStack();
    console.log('Owner stack:', ownerStack);
  }
  // ...
}
```

**Use case:** Custom error overlays, debugging tools.

---

### 3. Server Component Improvements

If using Server Components (not applicable to BudTags):
- Streaming enabled in edge environments
- Optimized wire format (smaller payloads)
- New `react-server-dom-parcel` package

---

### 4. Bug Fixes

Notable fixes:
- Warning for null/undefined in useEffect return
- Fixed dev-only methods in production builds
- Added beforetoggle/toggle events on dialog
- Fixed streaming issues with global errors
- Fixed pending chunks counted twice

---

## BudTags Impact

### Low Impact

This is a minor update. For BudTags:
- No breaking changes that affect our stack
- useId format change is internal
- No code changes required

### Recommended

```bash
# Simple update
npm install react@19.1 react-dom@19.1

# Test
npm test
npm run dev
```

---

## New Development Features

### captureOwnerStack

Useful for custom debugging:

```typescript
// In a custom error boundary or debugging component
if (process.env.NODE_ENV === 'development') {
  const ownerStack = captureOwnerStack();

  // ownerStack shows which component rendered this one
  // Different from component stack (which shows hierarchy)
}
```

### Improved Dialog Events

```typescript
<dialog
  onBeforeToggle={(e) => {
    // Fires before dialog opens/closes
    console.log('Dialog will', e.newState);
  }}
  onToggle={(e) => {
    // Fires after dialog opens/closes
    console.log('Dialog is now', e.newState);
  }}
>
  Content
</dialog>
```

---

## Testing

After updating:

```bash
# Run tests
npm test

# Check for console warnings in dev
npm run dev

# Test any useId usage (should still work)
```

---

## Checklist

- [ ] Update react and react-dom to 19.1
- [ ] Run tests
- [ ] Check for console warnings
- [ ] Test forms and modals (dialog events)

## Next Steps

- Read `19-1-to-19-2.md` for 19.2 migration
- Read `14-breaking-changes.md` for all changes
