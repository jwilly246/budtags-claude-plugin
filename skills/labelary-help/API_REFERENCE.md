# Labelary API Reference

Complete reference for all Labelary API endpoints, parameters, headers, and response codes.

---

## Base URL

```
http://api.labelary.com/v1/
```

**Premium Users:** Replace hostname with your private API hostname provided via email.

---

## Endpoints

### 1. Convert ZPL to Image/PDF (GET)

```
GET /printers/{dpmm}/labels/{width}x{height}/{index}/{zpl}
```

Convert ZPL code embedded in the URL to an image or document.

#### URL Parameters

| Parameter | Type | Required | Description | Valid Values |
|-----------|------|----------|-------------|--------------|
| `dpmm` | string | Yes | Print density in dots per millimeter | `6dpmm`, `8dpmm`, `12dpmm`, `24dpmm` |
| `width` | number | Yes | Label width in inches | Any numeric value (max 15) |
| `height` | number | Yes | Label height in inches | Any numeric value (max 15) |
| `index` | integer | Yes | Label index (base 0) | 0 to (label count - 1) |
| `zpl` | string | Yes | ZPL code to render | Valid ZPL code (URL-encoded) |

#### Request Headers

| Header | Type | Required | Description | Valid Values |
|--------|------|----------|-------------|--------------|
| `Accept` | string | No | Output format (default: `image/png`) | See [Output Formats](#output-formats) |

#### Response

- **Success**: Binary data (image/PDF/other format)
- **Content-Type**: Matches requested `Accept` header
- **Headers**: `X-Total-Count` (number of labels generated)

#### Example

```bash
# Convert ZPL to PNG
curl --get http://api.labelary.com/v1/printers/8dpmm/labels/4x6/0/ \
  --data-urlencode "^xa^cfa,50^fo100,100^fdHello World^fs^xz" > label.png
```

**Important:**
- ‚úÖ Encode `#` characters as `%23` in ZPL
- ‚úÖ URL length limited to ~3,000 characters
- ‚ö†Ô∏è Use POST for production applications

---

### 2. Convert ZPL to Image/PDF (POST)

```
POST /printers/{dpmm}/labels/{width}x{height}/{index}
```

Convert ZPL code sent in the request body to an image or document.

#### URL Parameters

| Parameter | Type | Required | Description | Valid Values |
|-----------|------|----------|-------------|--------------|
| `dpmm` | string | Yes | Print density in dots per millimeter | `6dpmm`, `8dpmm`, `12dpmm`, `24dpmm` |
| `width` | number | Yes | Label width in inches | Any numeric value (max 15) |
| `height` | number | Yes | Label height in inches | Any numeric value (max 15) |
| `index` | integer | Optional | Label index (base 0). Omit for multi-label PDFs | 0 to (label count - 1) |

#### Request Headers

| Header | Type | Required | Description | Valid Values |
|--------|------|----------|-------------|--------------|
| `Content-Type` | string | Yes | Request body format | `application/x-www-form-urlencoded` or `multipart/form-data` |
| `Accept` | string | No | Output format (default: `image/png`) | See [Output Formats](#output-formats) |
| `X-Rotation` | integer | No | Rotate label clockwise | `0`, `90`, `180`, `270` |
| `X-Quality` | string | No | PNG quality (PNG only) | `Grayscale` (default), `Bitonal` |
| `X-Linter` | string | No | Enable ZPL linting | `On`, `Off` (default) |
| `X-Page-Size` | string | No | PDF page size (PDF only) | `Letter`, `Legal`, `A4`, `A5`, `A6` |
| `X-Page-Orientation` | string | No | PDF orientation (PDF only) | `Portrait`, `Landscape` |
| `X-Page-Layout` | string | No | Labels per page (PDF only) | `{cols}x{rows}` (e.g., `2x3`) |
| `X-Page-Align` | string | No | Horizontal alignment (PDF only) | `Left`, `Right`, `Center`, `Justify` (default) |
| `X-Page-Vertical-Align` | string | No | Vertical alignment (PDF only) | `Top`, `Bottom`, `Center`, `Justify` (default) |
| `X-Label-Border` | string | No | Label border style (PDF only) | `Dashed` (default), `Solid`, `None` |

#### Request Body

**Content-Type: `application/x-www-form-urlencoded`**
- Body contains raw ZPL code

**Content-Type: `multipart/form-data`**
- Body contains form parameter named `file` with ZPL code

#### Response Headers

| Header | Type | Description |
|--------|------|-------------|
| `Content-Type` | string | Output format MIME type |
| `X-Total-Count` | integer | Number of labels generated by ZPL |
| `X-Warnings` | string | Linting warnings (if `X-Linter: On`) |

#### Example: Basic POST

```bash
# Convert ZPL to PNG
curl --request POST http://api.labelary.com/v1/printers/8dpmm/labels/4x6/0/ \
  --data "^xa^cfa,50^fo100,100^fdHello World^fs^xz" > label.png
```

#### Example: POST with PDF

```bash
# Convert ZPL to PDF
curl --request POST http://api.labelary.com/v1/printers/8dpmm/labels/4x6/0/ \
  --header "Accept: application/pdf" \
  --data "^xa^cfa,50^fo100,100^fdHello World^fs^xz" > label.pdf
```

#### Example: Multipart Form Data

```bash
# Convert ZPL file to PNG
curl --request POST http://api.labelary.com/v1/printers/8dpmm/labels/4x6/0/ \
  --form file=@label.zpl > label.png
```

#### Example: Advanced PDF with Layout

```bash
# Multi-label PDF on Letter paper, 2x3 layout
curl --request POST http://api.labelary.com/v1/printers/8dpmm/labels/4x6/ \
  --header "Accept: application/pdf" \
  --header "X-Page-Size: Letter" \
  --header "X-Page-Layout: 2x3" \
  --header "X-Label-Border: Solid" \
  --data "@labels.zpl" > sheet.pdf
```

#### Example: JSON Data Extraction

```bash
# Extract text data from ZPL
curl --request POST http://api.labelary.com/v1/printers/8dpmm/labels/4x6/0/ \
  --header "Accept: application/json" \
  --data "^xa^ft50,50^a0,50^fdHello^fs^xz"
```

**Response:**
```json
{
  "labels": [
    {
      "fields": [
        { "x": 50, "y": 50, "data": "Hello" }
      ]
    }
  ]
}
```

---

### 3. Convert Image to ZPL Graphics

```
POST /graphics
```

Convert a raster image (PNG, JPG, etc.) to ZPL graphics code.

#### Request Headers

| Header | Type | Required | Description | Valid Values |
|--------|------|----------|-------------|--------------|
| `Content-Type` | string | Yes | Must be multipart/form-data | `multipart/form-data` |
| `Accept` | string | No | Output format (default: `application/zpl`) | `application/zpl`, `application/json`, `application/epl`, `application/ipl`, `application/dpl`, `application/sbpl`, `application/pcl5`, `application/pcl6` |

#### Request Body

**Form Parameters:**

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `file` | file | Yes | Image file to convert (PNG, JPG, etc.) |

#### Response

- **Success**: ZPL graphics code or other format
- **Content-Type**: Matches requested `Accept` header

#### Limits

- Maximum image dimensions: 2,000 pixels √ó 2,000 pixels
- Maximum image file size: 200 KB

#### Example: Image to ZPL

```bash
# Convert image.png to ZPL graphics
curl --request POST http://api.labelary.com/v1/graphics \
  --form file=@image.png > image.zpl
```

#### Example: Image to EPL

```bash
# Convert image.png to EPL format
curl --request POST http://api.labelary.com/v1/graphics \
  --form file=@image.png \
  --header "Accept: application/epl" > image.epl
```

#### Output Format

ZPL graphics output typically uses `^GF` (Graphics Field) command:

```zpl
^GFA,{bytes},{bytes},{rowbytes},{hex_data}
```

**See:** `docs/07-image-font-conversion.md` for complete details

---

### 4. Convert TrueType Font to ZPL

```
POST /fonts
```

Convert a TrueType font file (.ttf) to ZPL font download commands.

#### Request Headers

| Header | Type | Required | Description |
|--------|------|----------|-------------|
| `Content-Type` | string | Yes | Must be multipart/form-data | `multipart/form-data` |

#### Request Body

**Form Parameters:**

| Parameter | Type | Required | Description | Valid Values |
|-----------|------|----------|-------------|--------------|
| `file` | file | Yes | TrueType font file (.ttf) | Valid TTF file |
| `path` | string | No | Printer storage path | Regex: `[REBA]:[A-Z0-9]{1,16}.TTF` |
| `name` | string | No | Single-letter font shortcut | Regex: `[IKMOWXYZ]` |
| `chars` | string | No | Characters to include (subsetting) | Any string (e.g., `0123456789`) |

#### Response

- **Success**: ZPL font download commands
- **Content-Type**: `text/plain`

#### Limits

- Maximum font file size: 200 KB

#### Font Subsetting

The `chars` parameter limits the font to specific characters, reducing ZPL file size.

**Example:** For a numeric-only font, use `chars=0123456789`

**Important:** Check font license before subsetting. Some fonts prohibit modification.

#### Example: Basic Conversion

```bash
# Convert Montserrat-Bold.ttf to ZPL
curl --request POST http://api.labelary.com/v1/fonts \
  --form file=@Montserrat-Bold.ttf > font.zpl
```

#### Example: With Shortcut and Subsetting

```bash
# Convert with single-letter name 'Z', uppercase letters only
curl --request POST http://api.labelary.com/v1/fonts \
  --form file=@Montserrat-Bold.ttf \
  --form name=Z \
  --form chars=ABCDEFGHIJKLMNOPQRSTUVWXYZ > font.zpl
```

#### Output Format

ZPL font output typically uses `~DU` (Download Unbounded TrueType Font):

```zpl
~DU{path},{name},{orientation},{size},{hex_data}
```

**See:** `docs/07-image-font-conversion.md` for complete details

---

## Output Formats

Control output format with the `Accept` request header.

| Accept Header | Format | Use Case |
|---------------|--------|----------|
| `image/png` | PNG image | Web preview, default format |
| `application/pdf` | PDF document | Multi-label sheets, print-ready output |
| `application/json` | JSON data | Data extraction, validation, testing |
| `application/ipl` | IPL (Intermec) | Intermec printers |
| `application/epl` | EPL (Eltron) | Eltron/Zebra EPL printers |
| `application/dpl` | DPL (Datamax) | Datamax printers |
| `application/sbpl` | SBPL (SATO) | SATO printers |
| `application/pcl5` | PCL 5 | HP printers (PCL 5) |
| `application/pcl6` | PCL 6 | HP printers (PCL 6) |

**Default:** `image/png` (if `Accept` header omitted)

---

## DPI to DPMM Conversion

Labelary uses **dpmm (dots per millimeter)** instead of DPI.

### Conversion Formula

```javascript
const dpmm = Math.round(dpi / 25.4);
```

### Common Conversions

| DPI | DPMM | Valid? | Notes |
|-----|------|--------|-------|
| 152 | 6 | ‚úÖ `6dpmm` | Low resolution |
| 203 | 8 | ‚úÖ `8dpmm` | **Most common Zebra printer** |
| 300 | 12 | ‚úÖ `12dpmm` | High resolution Zebra |
| 600 | 24 | ‚úÖ `24dpmm` | Very high resolution |

**Valid values only:** `6dpmm`, `8dpmm`, `12dpmm`, `24dpmm`

### Implementation Example

```javascript
function getDpmm(dpi) {
    const dpmm = Math.round(dpi / 25.4);
    const validDpmm = [6, 8, 12, 24];

    if (!validDpmm.includes(dpmm)) {
        throw new Error(`Invalid dpmm: ${dpmm}. Must be 6, 8, 12, or 24`);
    }

    return `${dpmm}dpmm`;
}

// Usage
const dpmm = getDpmm(203); // "8dpmm"
```

**See:** `CODE_EXAMPLES.md` for complete React/TypeScript implementation

---

## Error Responses

### HTTP Status Codes

| Status Code | Reason | Description | Solution |
|-------------|--------|-------------|----------|
| **200** | Success | Request processed successfully | - |
| **400** | Bad Request | Invalid parameters or ZPL | Check parameters, validate ZPL |
| **413** | Payload Too Large | Request body exceeds 1 MB | Reduce ZPL size or split labels |
| **429** | Too Many Requests | Rate limit exceeded | Implement throttling, upgrade plan |
| **500** | Internal Server Error | Labelary service error | Retry request, contact support |

### Error Response Body

Error responses typically return plain text with error description:

```
Error: Invalid dpmm value. Must be 6dpmm, 8dpmm, 12dpmm, or 24dpmm
```

### Common Errors

#### 1. Invalid DPMM

**Error:**
```
HTTP 400: Invalid dpmm value
```

**Cause:** Used DPI value instead of dpmm, or invalid dpmm value

**Solution:**
```javascript
// ‚ùå Wrong - using DPI directly
const url = `http://api.labelary.com/v1/printers/203dpmm/...`;

// ‚úÖ Correct - convert DPI to dpmm
const dpmm = Math.round(203 / 25.4); // 8
const url = `http://api.labelary.com/v1/printers/${dpmm}dpmm/...`;
```

#### 2. Rate Limit Exceeded

**Error:**
```
HTTP 429: Too Many Requests
```

**Cause:** Exceeded 3 requests/second or 5,000 requests/day (free tier)

**Solution:**
```javascript
// Implement client-side throttling
const delay = (ms) => new Promise(resolve => setTimeout(resolve, ms));

async function fetchWithThrottle(url, options) {
    await delay(350); // 350ms = ~2.8 req/sec (under 3 req/sec limit)
    return fetch(url, options);
}
```

**See:** `INTEGRATION_GUIDE.md` for throttling implementation

#### 3. Label Dimensions Too Large

**Error:**
```
HTTP 400: Label dimensions exceed maximum
```

**Cause:** Width or height exceeds 15 inches

**Solution:** Reduce label dimensions to 15" or less

#### 4. ZPL Contains Errors

**Enable linting to detect errors:**

```bash
curl --request POST http://api.labelary.com/v1/printers/8dpmm/labels/4x6/0/ \
  --header "X-Linter: On" \
  --data "^xa^invalid_command^xz"
```

**Check `X-Warnings` response header for details**

**See:** `docs/06-advanced-features.md` section 6.8 for linting details

---

## Rate Limits

### Free Tier Limits

| Limit Type | Free Tier | Error Response |
|------------|-----------|----------------|
| Requests per second | 3 | HTTP 429 |
| Requests per day | 5,000 | HTTP 429 |
| Labels per request | 50 | HTTP 413 |
| Request body size | 1 MB | HTTP 413 |
| Label dimensions | 15 inches | HTTP 400 |
| Embedded image size | 2,000 pixels | HTTP 400 |
| Embedded object size | 2 MB | HTTP 400 |
| Printer memory | 2 MB | HTTP 400 |
| Output PNG buffer | 10 MB | HTTP 400 |
| Image dimensions (graphics API) | 2,000 pixels | HTTP 400 |
| Image file size (graphics API) | 200 KB | HTTP 400 |
| Font file size (fonts API) | 200 KB | HTTP 400 |

### Premium Plans

| Plan | Price | Req/Sec | Req/Day | Support | SLA |
|------|-------|---------|---------|---------|-----|
| Free | $0 | 3 | 5,000 | None | None |
| Plus | $90/month | 6 | 20,000 | Basic | 99% |
| Business | $228/month | 10 | 40,000 | Premium | 99.9% |
| On-Prem | Custom | Unlimited | Unlimited | Premium | Custom |

**See:** `docs/03-limits-and-pricing.md` for complete details

---

## Advanced Features

### 1. Rotate Labels

Use `X-Rotation` header to rotate output:

```bash
curl --request POST http://api.labelary.com/v1/printers/8dpmm/labels/4x6/0/ \
  --header "X-Rotation: 90" \
  --data "^xa^cfa,50^fo100,100^fdRotated^fs^xz" > rotated.png
```

**Valid values:** `0`, `90`, `180`, `270` (degrees clockwise)

### 2. Multi-Label PDFs

Omit `index` parameter to get all labels in one PDF:

```bash
# Single label (index 0)
curl --request POST http://api.labelary.com/v1/printers/8dpmm/labels/4x6/0/ \
  --header "Accept: application/pdf" \
  --data "^xa...^xz^xa...^xz" > single.pdf

# All labels (no index)
curl --request POST http://api.labelary.com/v1/printers/8dpmm/labels/4x6/ \
  --header "Accept: application/pdf" \
  --data "^xa...^xz^xa...^xz" > all.pdf
```

### 3. Custom PDF Page Layouts

```bash
# 2√ó3 labels on Letter paper, portrait
curl --request POST http://api.labelary.com/v1/printers/8dpmm/labels/4x6/ \
  --header "Accept: application/pdf" \
  --header "X-Page-Size: Letter" \
  --header "X-Page-Orientation: Portrait" \
  --header "X-Page-Layout: 2x3" \
  --header "X-Page-Align: Center" \
  --header "X-Page-Vertical-Align: Center" \
  --header "X-Label-Border: Solid" \
  --data "@labels.zpl" > sheet.pdf
```

### 4. ZPL Linting

```bash
curl --request POST http://api.labelary.com/v1/printers/8dpmm/labels/4x6/0/ \
  --header "X-Linter: On" \
  --data "^xa^gb1,1,3^fs^xz" \
  --dump-header -
```

**Check `X-Warnings` response header:**
```
X-Warnings: 303|1|^GB|2|Value 1 is less than minimum value 3; used 3 instead
```

**Warning format:** `byte_index|byte_size|command|parameter|message`

### 5. Data Extraction (JSON)

```bash
curl --request POST http://api.labelary.com/v1/printers/8dpmm/labels/4x6/0/ \
  --header "Accept: application/json" \
  --data "^xa^ft50,50^a0,50^fdTest^fs^xz"
```

**Response:**
```json
{
  "labels": [
    {
      "fields": [
        { "x": 50, "y": 50, "data": "Test" }
      ]
    }
  ]
}
```

**Use cases:**
- Validate ZPL templates
- Extract barcode text
- Test label content

**See:** `docs/06-advanced-features.md` for all advanced features

---

## Best Practices

### 1. Use POST in Production

‚úÖ **Recommended:**
```javascript
fetch(apiUrl, {
    method: 'POST',
    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
    body: zplCode
});
```

‚ùå **Not recommended for production:**
```javascript
fetch(`${apiUrl}${encodeURIComponent(zplCode)}`);
```

**Reasons:**
- POST has no URL length limit
- POST requests aren't logged by proxies
- POST handles binary data correctly

### 2. Always Convert DPI to DPMM

```javascript
// ‚úÖ Correct
const dpmm = Math.round(dpi / 25.4);
const apiUrl = `http://api.labelary.com/v1/printers/${dpmm}dpmm/labels/${w}x${h}/0/`;

// ‚ùå Wrong
const apiUrl = `http://api.labelary.com/v1/printers/${dpi}dpmm/labels/${w}x${h}/0/`;
```

### 3. Handle Errors Gracefully

```javascript
try {
    const response = await fetch(apiUrl, options);

    if (!response.ok) {
        if (response.status === 429) {
            // Rate limit - implement retry with backoff
            await delay(1000);
            return fetchLabelaryImage(); // Retry
        }
        throw new Error(`Labelary API returned ${response.status}: ${response.statusText}`);
    }

    return await response.blob();
} catch (error) {
    console.error('Labelary preview failed:', error);
    // Show user-friendly error message
}
```

### 4. Clean Up Object URLs

```javascript
const url = URL.createObjectURL(blob);
setImageUrl(url);

// Clean up when component unmounts
return () => {
    if (url) {
        URL.revokeObjectURL(url);
    }
};
```

### 5. Implement Client-Side Throttling

```javascript
// Rate limiter for free tier (3 req/sec)
class RateLimiter {
    constructor(maxPerSecond) {
        this.maxPerSecond = maxPerSecond;
        this.queue = [];
    }

    async execute(fn) {
        while (this.queue.length >= this.maxPerSecond) {
            await delay(1000);
            this.queue = this.queue.filter(t => Date.now() - t < 1000);
        }
        this.queue.push(Date.now());
        return fn();
    }
}

const limiter = new RateLimiter(2); // 2 req/sec (safety margin)
await limiter.execute(() => fetch(apiUrl, options));
```

**See:** `CODE_EXAMPLES.md` and `INTEGRATION_GUIDE.md` for complete implementations

---

## Quick Reference

### Common Operations

| Task | Endpoint | Method | Accept Header |
|------|----------|--------|---------------|
| ZPL ‚Üí PNG preview | `/printers/8dpmm/labels/4x6/0/` | POST | `image/png` |
| ZPL ‚Üí PDF document | `/printers/8dpmm/labels/4x6/0/` | POST | `application/pdf` |
| ZPL ‚Üí All labels PDF | `/printers/8dpmm/labels/4x6/` | POST | `application/pdf` |
| Validate ZPL data | `/printers/8dpmm/labels/4x6/0/` | POST | `application/json` |
| Image ‚Üí ZPL graphics | `/graphics` | POST | `application/zpl` |
| Font ‚Üí ZPL font | `/fonts` | POST | - |

### DPI Conversions

| DPI | DPMM | Common Printer |
|-----|------|----------------|
| 152 | 6 dpmm | Low-res Zebra |
| 203 | 8 dpmm | **Standard Zebra** |
| 300 | 12 dpmm | High-res Zebra |
| 600 | 24 dpmm | Very high-res |

### Rate Limits (Free)

- ‚è±Ô∏è 3 requests/second
- üìä 5,000 requests/day
- üì¶ 50 labels/request
- üíæ 1 MB request body

---

**See Also:**
- `CODE_EXAMPLES.md` - Real React/TypeScript implementations
- `INTEGRATION_GUIDE.md` - Step-by-step integration walkthrough
- `docs/` - Complete Labelary documentation
- `WORKFLOWS/` - Task-specific guides
