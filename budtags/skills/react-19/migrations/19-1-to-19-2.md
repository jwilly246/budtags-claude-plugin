# Migration Guide: React 19.1 to React 19.2

Changes and migration steps from React 19.1 to React 19.2 (October 2025).

## Overview

React 19.2 introduces significant new features:
- **Activity component** - Hide/show UI while preserving state
- **useEffectEvent** - Extract event logic from effects
- **Performance Tracks** - Chrome DevTools integration
- **Partial Pre-rendering** - Advanced SSR feature

---

## Package Update

```bash
npm install react@19.2 react-dom@19.2
npm install -D @types/react@19 @types/react-dom@19

# Required for useEffectEvent
npm install -D eslint-plugin-react-hooks@latest
```

---

## Breaking Changes

### 1. useId Format Change (Again)

**Before (19.1):** `«r123»`
**After (19.2):** `_r123_`

```typescript
const id = useId();
// 19.1: "«r0»"
// 19.2: "_r0_"
```

**Reason:** New format is valid for CSS `view-transition-name` and XML 1.0.

**Impact:** Low - unless parsing useId output.

---

### 2. ESLint Plugin Update Required

For `useEffectEvent`, you need ESLint plugin v6:

```bash
npm install -D eslint-plugin-react-hooks@latest
```

**If using legacy ESLint config:**
```javascript
// Before
extends: ['plugin:react-hooks/recommended']

// If issues, use legacy config
extends: ['plugin:react-hooks/recommended-legacy']
```

---

## New Features

### Activity Component

Hide UI while preserving state:

```typescript
import { Activity } from 'react';

function TabContainer() {
  const [activeTab, setActiveTab] = useState('packages');

  return (
    <>
      <Activity mode={activeTab === 'packages' ? 'visible' : 'hidden'}>
        <PackagesTab />
      </Activity>

      <Activity mode={activeTab === 'transfers' ? 'visible' : 'hidden'}>
        <TransfersTab />
      </Activity>
    </>
  );
}
```

**Benefits:**
- State preserved when hidden (inputs, scroll position)
- Effects unmounted when hidden (no background work)
- Updates deferred until React is idle

See `patterns/11-activity-component.md` for details.

---

### useEffectEvent

Extract "event" logic from Effect dependencies:

```typescript
import { useEffectEvent } from 'react';

function ChatRoom({ roomId, theme }) {
  // Event handler that always reads latest theme
  const onConnected = useEffectEvent(() => {
    showNotification('Connected!', theme);
  });

  useEffect(() => {
    const connection = createConnection(roomId);
    connection.on('connected', onConnected);
    connection.connect();
    return () => connection.disconnect();
  }, [roomId]); // No theme in deps!
}
```

**Key rules:**
- Don't include in dependency array
- Only call from Effects
- ESLint plugin v6 required

See `patterns/12-use-effect-event.md` for details.

---

### Performance Tracks

New Chrome DevTools integration:

1. Open DevTools → Performance
2. Record your app
3. Look for:
   - **Scheduler Track ⚛** - Work scheduling
   - **Components Track ⚛** - Render timing

See `patterns/13-performance-tracks.md` for details.

---

### cacheSignal (Server Components Only)

For RSC apps (not applicable to BudTags):

```typescript
import { cache, cacheSignal } from 'react';

const cachedFetch = cache(async (url) => {
  return fetch(url, { signal: cacheSignal() });
});
```

---

## BudTags Migration

### Step 1: Update Packages

```bash
npm install react@19.2 react-dom@19.2
npm install -D eslint-plugin-react-hooks@latest
```

### Step 2: Test Existing Code

```bash
npm test
npm run dev
```

Everything should work without changes.

### Step 3: Adopt New Features (Optional)

#### Use Activity for Tabs

```typescript
// Before: Conditional rendering (loses state)
{activeTab === 'packages' && <PackagesTab />}

// After: Activity (preserves state)
<Activity mode={activeTab === 'packages' ? 'visible' : 'hidden'}>
  <PackagesTab />
</Activity>
```

#### Use useEffectEvent for Cleaner Effects

```typescript
// Before: Too many dependencies
useEffect(() => {
  const handler = () => {
    toast(message, { position: toastPosition });
  };
  socket.on('event', handler);
  return () => socket.off('event', handler);
}, [message, toastPosition]); // These cause re-subscriptions

// After: Clean dependencies
const handleEvent = useEffectEvent(() => {
  toast(message, { position: toastPosition });
});

useEffect(() => {
  socket.on('event', handleEvent);
  return () => socket.off('event', handleEvent);
}, []); // Clean!
```

---

## Suspense Behavior Change

React 19.2 batches Suspense boundary reveals during SSR:

**Before:** Boundaries revealed individually as data loaded
**After:** Boundaries may be batched for smoother UX

This is generally an improvement, but if you relied on specific timing:
- Content may appear together instead of one-by-one
- React uses heuristics to avoid impacting Core Web Vitals

---

## ESLint Configuration

### Flat Config (New Default)

```javascript
// eslint.config.js
import reactHooks from 'eslint-plugin-react-hooks';

export default [
  {
    plugins: {
      'react-hooks': reactHooks,
    },
    rules: {
      ...reactHooks.configs.recommended.rules,
    },
  },
];
```

### Legacy Config

```javascript
// .eslintrc.js
module.exports = {
  extends: ['plugin:react-hooks/recommended-legacy'],
};
```

---

## Checklist

### Required
- [ ] Update react and react-dom to 19.2
- [ ] Update eslint-plugin-react-hooks to latest
- [ ] Run tests
- [ ] Check for console warnings

### Optional (Recommended)
- [ ] Use Activity for tab switching (preserves state)
- [ ] Use useEffectEvent for cleaner effect dependencies
- [ ] Try Performance Tracks for debugging

### Low Priority
- [ ] Review Suspense behavior if using SSR
- [ ] Check useId usage if you were parsing it (shouldn't be)

---

## Troubleshooting

### ESLint Errors with useEffectEvent

```
ESLint: React Hook useEffect has a missing dependency: 'onConnected'
```

**Fix:** Update ESLint plugin and don't include Effect Events in deps:

```bash
npm install -D eslint-plugin-react-hooks@latest
```

### Activity Not Preserving State

Check that:
1. Activity is not conditionally rendered
2. Key prop is stable
3. Mode changes (not conditional rendering)

```typescript
// ❌ Wrong: Conditional Activity
{showTabs && (
  <Activity mode={...}>
    <Tab />
  </Activity>
)}

// ✅ Right: Activity always rendered
<Activity mode={showTabs ? 'visible' : 'hidden'}>
  <Tab />
</Activity>
```

---

## Summary

| Feature | Impact | Action |
|---------|--------|--------|
| useId format | Low | None needed |
| ESLint plugin | Medium | Update if using useEffectEvent |
| Activity | Optional | Great for tabs/modals |
| useEffectEvent | Optional | Cleaner effect deps |
| Performance Tracks | Optional | Better debugging |

## Next Steps

- Read `11-activity-component.md` for Activity details
- Read `12-use-effect-event.md` for useEffectEvent details
- Read `13-performance-tracks.md` for debugging
